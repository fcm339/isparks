<html>
    <head>
        <title >首页</title>
        <meta charset="utf-8"/>
        <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport'/>
        <link rel="icon" href="../../../static/images/favicon.ico"  >
        <meta name="description" content="设置页面">
        <meta name="author" content="chenghd">
        <link href="../../../static/css/uikit.min.css"  rel="stylesheet"/>
        <link href="../../../static/css/uikit-rtl.min.css" rel="stylesheet"/>
        <link href="../../../static/css/main.css" rel="stylesheet"/>
    </head>
<body>
<!-- section start -->
<section th:fragment="fra" class="is-main-content">
<style>
    .is-widget-box{
        display: flex !important;
        flex-wrap: wrap !important;
        box-shadow: 0 0 28px rgb(0 0 0 / 8%);
        border-radius: 5px;
        overflow: hidden;
    }
    .is-widget-box div{
        box-sizing: border-box;
    }
    .is-widget-content{
        width: calc(100% - 60px);;
        padding: 20px 15px;
        min-height: 90px;
    }
    .is-widget-content-title{
        font-weight: 700;
        font-size: 24px;
        line-height: 1.42em;
        color: #343a40 !important;
    }
    .is-widget-content-text{
        font-weight: 500;
        font-size: 14px;
        line-height: 1.71em;
        color: #343a40 !important;
    }
    .is-widget-icon{
        width: 60px !important;
        text-align: center;
        display: flex;
        background: #334148;
        color: rgb(255, 255, 255);
        font-size: 30px
    }
    .is-widget-icon *{
        margin: auto;
    }
</style>
<div id="dash-page" v-cloak  uk-scrollspy="cls: uk-animation-slide-bottom; target:>div;delay: 300;">
    <div class="uk-placeholder" style="text-align: center;" >
        <h1 class="uk-heading-small"><span style="color: lightcoral;">i</span> Sparks !</h1>
        <small>这是一个简洁方便的建站系统。</small>
    </div>

    <div class="uk-child-width-1-4@m uk-child-width-1-3@s uk-child-width-1-1 uk-grid-match uk-grid-small" uk-grid style="width: 100%;" >
        <div v-for = "d in dataPanel">
            <div class="is-widget-box" >
                <div class="is-widget-content">
                    <div class="is-widget-content-title">
                        {{d.title}}
                    </div>
                    <div class="is-widget-content-text">
                        {{d.content}}
                    </div>
                </div>
                <div class="is-widget-icon">
                    <span>{{d.textIcon}}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="uk-child-width-1-2@m uk-child-width-1-1 uk-grid-match uk-grid-small" uk-grid style="width: 100%;">
        <div >
            <div class="uk-card uk-card-default uk-card-body uk-width-1-1@m">
                <h3 class="uk-card-title">链接</h3>
                <div>
                    <span uk-icon="heart"></span>
                    <span uk-icon="paint-bucket"></span>
                    <span uk-icon="camera"></span>
                </div>
            </div>
        </div>
        <div>
            <div class="uk-light uk-background-secondary uk-padding " style="border-radius: 5px;overflow:hidden;">
                <p>网站运行了：</p>
                <div id="countDown" class="uk-grid-small uk-child-width-auto uk-margin" uk-grid  style="display: flex;justify-content: center;">
                    <div>
                        <div class="uk-countdown-number uk-countdown-days">{{dateCount.difDays <= 9 ? '0' + dateCount.difDays : dateCount.difDays}}</div>
                        <div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">天</div>
                    </div>
                    <div>
                        <div class="uk-countdown-number uk-countdown-hours">{{dateCount.difHours <= 9 ? '0' + dateCount.difHours : dateCount.difHours}}</div>
                        <div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">时</div>
                    </div>
                    <div>
                        <div class="uk-countdown-number uk-countdown-minutes">{{dateCount.difMinutes <= 9 ? '0' + dateCount.difMinutes : dateCount.difMinutes}}</div>
                        <div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">分</div>
                    </div>
                    <div>
                        <div class="uk-countdown-number uk-countdown-seconds">{{dateCount.difSeconds <= 9 ? '0' + dateCount.difSeconds : dateCount.difSeconds}}</div>
                        <div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">秒</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="uk-child-width-1-1 uk-grid-match uk-grid-small" uk-grid style="width: 100%;">
        
        <div style="box-shadow: 0 0 28px rgb(0 0 0 / 10%);border-radius: 5px;overflow:hidden;">
            <table class="uk-table uk-table-responsive uk-table-divider" style="margin-bottom: 0;">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th style="text-align: start;">操作</th>
                        <th style="text-align: start;">类型</th>
                        <th style="text-align: start;">时间</th>
                        <th  style="text-align: start;">接口名</th>
                        <th  style="text-align: start;">ip</th>
                        <th  style="text-align: start;">用户</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for = "(log,index) in logData.logs">
                        <td>{{(logData.page - 1) * logData.size + index + 1}}</td>
                        <td>{{log.content}}</td>
                        <td>{{log.type}}</td>
                        <td>{{log.date}}</td>
                        <td>/admin/post/update</td>
                        <td>{{log.ip}}</td>
                        <td>admin</td>
                    </tr>
                </tbody>
            </table>
            <ul class="uk-pagination uk-flex-center" uk-margin  style="margin-top: 0;">
                <li><a href="#" @click="logPre"><span uk-pagination-previous></span></a></li>
                <li><a href="#" @click="logNext"><span uk-pagination-next></span></a></li>
            </ul>
        </div>
    </div>    

</div>
    

<script>
    function pageLoaded(config){
        var app = new Vue({
            el: '#dash-page',
            data:{
                dataPanel : [],
                logData :{
                    logs : [],
                    page : 1,
                    size : 10,
                    totalPage : 0,
                    totalData : 0
                },
                dateCount :{
                    installTime : 0 ,
                    dateCountTimer : null,
                    difDays : 0 ,
                    difHours : 0 ,
                    difMinutes : 0 ,
                    difSeconds : 0
                }
                
            },
            methods:{
                initPage(){
                    this.loadPanelData();
                    this.loadLogData();
                },
                loadPanelData(){
                    axios.get("/api/admin/page/dash").then(res => {
                        if(res.data.code == 8101){
                            this.dataPanel = res.data.data.panel;
                            this.dateCount.installTime = res.data.data.installTime ? res.data.data.installTime : new Date().getTime();
                            this.startCountDate();
                        }
                    }).catch(err => {
                        console.log(err);
                    });
                },
                loadLogData(){
                    axios.get("/api/admin/log/page",{
                        params:{
                            page:this.logData.page,
                            size:this.logData.size
                        }
                    }).then(res => {
                        console.log(res);
                        if(res.data.code == 8101){
                            this.logData.logs = res.data.data.data;
                            this.logData.page = res.data.data.page;
                            this.logData.size = res.data.data.size;
                            this.logData.totalData = res.data.data.totalData;
                            this.logData.totalPage = res.data.data.totalPage;
                        }
                    }).catch(err => {
                        console.log(err);
                    });
                },
                startCountDate(){ // 启动时间统计
                    if(this.dateCount.dateCountTimer != null){
                        clearInterval(this.dateCountTimer);
                    }

                    const installTime = this.dateCount.installTime;
                    let difTime = new Date().getTime() - installTime;

                    this.dateCount.difDays = Math.floor(difTime / (24 * 3600 * 1000)) ;
                    difTime %= (24 * 3600 * 1000); 
                    this.dateCount.difHours = Math.floor(difTime / ( 3600 * 1000)) ;
                    difTime %= ( 3600 * 1000); 
                    this.dateCount.difMinutes = Math.floor(difTime / ( 60 * 1000)) ;
                    difTime %= ( 60 * 1000); 
                    this.dateCount.difSeconds = Math.floor(difTime / ( 1000)) ;;

                    
                    this.dateCount.dateCountTimer = setInterval(() => {
                        if(this.dateCount.difSeconds < 59){
                            this.dateCount.difSeconds ++ ;
                        }else{
                            this.dateCount.difSeconds = 0;
                            if(this.dateCount.difMinutes < 59){
                                this.dateCount.difMinutes ++ ;
                            }else{
                                this.dateCount.difMinutes = 0;
                                if(this.dateCount.difHours < 23){
                                    this.dateCount.difHours ++ ;
                                }else{
                                    this.dateCount.difHours = 0 ;
                                    this.dateCount.difDays ++ ;
                                }
                            }
                        }
                    },1000);

                },
                logPre(){
                    if(this.logData.page > 1){
                        this.logData.page -= 1;
                        this.loadLogData();
                    }
                },
                logNext(){
                    if(this.logData.page < this.logData.totalPage){
                        this.logData.page += 1 ;
                        this.loadLogData();
                    }
                }
            },
            created(){
                this.initPage();
            }
        });
    }
    </script>
</section>
<!-- section end -->

</body>
<script src="../../../static/js/uikit.min.js" type="text/javascript"></script>
<script src="../../../static/js/uikit-icons.min.js" type="text/javascript"></script>
<script src="../../../static/js/app.js" type="text/javascript"></script>
</html>
